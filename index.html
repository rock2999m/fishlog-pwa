<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>GAS base64画像送信テスト</title>
  <style>
    body { font-family: sans-serif; }
    #result { background: #f8f8dd; margin-top: 1em; padding: 1em; border-radius: 6px; }
  </style>
</head>
<body>
  <h2>GASにbase64画像＋テキストを送信テスト</h2>
  <form id="fishForm">
    <div>
      <label>写真
        <input type="file" id="photo" name="">
      </label>
    </div>
    <div>
      <label>メモ
        <input type="text" name="memo" value="テスト送信">
      </label>
    </div>
    <div>
      <label>魚種
        <input type="text" name="species" value="ひらめ">
      </label>
    </div>
    <div>
      <label>サイズ
        <input type="text" name="size" value="60">
      </label>
    </div>
    <div>
      <label>日付
        <input type="date" name="date" value="2025-07-07">
      </label>
    </div>
    <div>
      <label>場所
        <input type="text" name="place" value="垂水">
      </label>
    </div>
    <button type="submit">送信</button>
  </form>
  <div id="result"></div>

  <script>
    document.getElementById('fishForm').addEventListener('submit', function(e){
      e.preventDefault();

      const form = e.target;
      const formData = new FormData(form);

      const fileInput = document.getElementById('photo');
      const file = fileInput.files[0];

      if (file) {
        const reader = new FileReader();
        reader.onload = function(evt) {
          const base64 = evt.target.result.split(',')[1];
          formData.append('photo_base64', base64);
          formData.append('photo_name', file.name);

          // 送信前確認ログ
          for (let pair of formData.entries()) {
            console.log('送信内容', pair[0], pair[1]);
          }

          sendFormData(formData);
        };
        reader.readAsDataURL(file);
      } else {
        sendFormData(formData);
      }

      function sendFormData(fd) {
        const GAS_URL = "https://script.google.com/macros/s/AKfycbwX_o0m5Y2m2j4iQhz7PW6RaOxxCRyvotSmMQNhHQNFo4B7SNEhorW1vWiFuQGC6S51BQ/exec"; // ←あなたのGASウェブアプリURLに置き換えてください
        document.getElementById('result').textContent = '送信中…';
        fetch(GAS_URL, {
          method: "POST",
          body: fd
        })
        .then(async res => {
          let resText = await res.text();
          document.getElementById('result').textContent = resText;
          console.log('レスポンス:', resText);
        })
        .catch(err => {
          document.getElementById('result').textContent = "送信エラー: " + err;
        });
      }
    });
  </script>
</body>
</html>
